<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coding.admin.mapper.postgresql.KnowledgeBaseMapper">

    <update id="increaseVectorCount">
        UPDATE knowledge_base
        SET vector_count = vector_count + #{count},
            update_time = CURRENT_TIMESTAMP
        WHERE id = #{id} AND deleted = 0
    </update>

    <update id="decreaseVectorCount">
        UPDATE knowledge_base
        SET vector_count = CASE
            WHEN vector_count >= #{count} THEN vector_count - #{count}
            ELSE 0
        END,
        update_time = CURRENT_TIMESTAMP
        WHERE id = #{id} AND deleted = 0
    </update>

</mapper>

